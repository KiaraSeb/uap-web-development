<nueva-tarea-form>
  <div class="buscador">
    <input 
      type="text" 
      name="content" 
      placeholder="What do you need to do?" 
      maxlength="20" 
      required 
    />
    <button class="boton-add" type="button">ADD</button>
  </div>
</nueva-tarea-form>

<script>
  import type { Tarea } from "../type";

  interface CustomWindow extends Window {
    listarTareas: () => Promise<void>;
  }

  declare const window: CustomWindow;

  class NuevaTareaForm extends HTMLElement {
    private input: HTMLInputElement | null = null;
    private button: HTMLButtonElement | null = null;

    connectedCallback() {
      this.input = this.querySelector("input");
      this.button = this.querySelector("button");
      if (this.button) {
        this.button.addEventListener("click", this.handleCreateNewTarea);
      }
      if (this.input) {
        this.input.addEventListener("keypress", (e: KeyboardEvent) => {
          if (e.key === "Enter") this.handleCreateNewTarea();
        });
      }
    }

    handleCreateNewTarea = async () => {
      const content = this.input?.value?.trim();
      if (!content) return;

      const response = await fetch("/api/tareas", {
        method: "POST",
        body: JSON.stringify({ content }),
        headers: {
          "Content-Type": "application/json",
        },
      });

      if (!response.ok) {
        return;
      }

      const data: { tarea: Tarea } = await response.json();
      if (this.input) {
        this.input.value = "";
      }
      if (typeof window.listarTareas === "function") {
        window.listarTareas();
      }
    };
  }

  customElements.define("nueva-tarea-form", NuevaTareaForm);
</script>